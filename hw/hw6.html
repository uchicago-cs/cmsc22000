
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Homework 6: Continuous Integration &#8212; CMSC 22000 - Introduction to Software Development</title>

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/bootstrap-sphinx.css" />
    <link rel="stylesheet" type="text/css" href="../_static/chiweb.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Homework 7: Deployment" href="hw7.html" />
    <link rel="prev" title="Homework 5: Testing" href="hw5.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.12.4.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.4.1/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          CMSC 22000 - Introduction to Software Development</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              
              
            
            
            
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Course Information <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../syllabus.html">Syllabus</a></li>
        <li><a href="../calendar.html">Calendar</a></li>
        <li><a href="../code-of-conduct.html">Code of Conduct for Course Staff</a></li>
    </ul>
</li>
<li><a href="index.html">Homework</a></li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Project <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../project/index.html">Introduction</a></li>
        <li><a href="../project/chiventure.html">chiventure</a></li>
        <li><a href="../project/policies.html">Policies</a></li>
        <li><a href="../project/features.html">Features</a></li>
    </ul>
</li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Resources <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../resources/faq.html">CS 220 FAQs</a></li>
        <li><a href="../resources/tutorials/index.html">Tutorials</a></li>
        <li><a href="https://uchicago-cs.github.io/dev-guide/" target="_blank">UChicago CS Developer's Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="https://uchicago-cs.github.io/debugging-guide" target="_blank">The Debugging Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="../resources/other.html">Other Resources</a></li>
    </ul>
</li>

            
          </ul>

          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
      <div class="col-md-3">
        <div id="sidebar" class="bs-sidenav" role="complementary"><ul>
<li><a class="reference internal" href="#">Homework 6: Continuous Integration</a><ul>
<li><a class="reference internal" href="#creating-your-homework-repository">Creating your homework repository</a></li>
<li><a class="reference internal" href="#task-1-building-your-code-with-ci">Task 1: Building your code with CI</a></li>
<li><a class="reference internal" href="#task-2-multiple-jobs">Task 2: Multiple jobs</a></li>
<li><a class="reference internal" href="#task-3-supporting-different-environments">Task 3: Supporting Different Environments</a></li>
<li><a class="reference internal" href="#task-4-tweaking-the-matrix">Task 4: Tweaking the Matrix</a></li>
</ul>
</li>
<li><a class="reference internal" href="#submitting-your-homework">Submitting your homework</a></li>
</ul>

        </div>
      </div>
    <div class="body col-md-9 content" role="main">
      
  <div class="section" id="homework-6-continuous-integration">
<h1>Homework 6: Continuous Integration<a class="headerlink" href="#homework-6-continuous-integration" title="Permalink to this headline">¶</a></h1>
<div class="admonition danger">
<p class="admonition-title">Danger</p>
<p>This homework has not yet been updated for the Spring 2022 edition of CMSC 22000.
If you are currently taking this class, you’re welcome to take a look at the homework below,
but bear in mind that it could change substantially. Do not start working on the homework
until instructed to do so.</p>
</div>
<p><strong>Due:</strong> Wednesday, May 11, 8pm CDT</p>
<p>Continuous Integration, or CI, is the practice of frequently merging
developers’ work into a mainline branch in a version control system like
Git. CI almost always involves running an extensive set of test cases
every time such a merge happens, or even every time new code is
committed to the repository (not just on the mainline branch, but also
on other branches). Thus many version control systems facilitate CI by
providing mechanisms to trigger certain actions when code is pushed to a
repository.</p>
<p>In this homework, we are going to explore the CI features available through
<a class="reference external" href="https://docs.github.com/en/actions">GitHub Actions</a>, a mechanism
provided by GitHub that allows you to run a series of actions whenever you push new
code to your repository, and which can be used to implement continuous integration
in a repository.</p>
<div class="section" id="creating-your-homework-repository">
<h2>Creating your homework repository<a class="headerlink" href="#creating-your-homework-repository" title="Permalink to this headline">¶</a></h2>
<p>Like previous homeworks, we will provide you with an <em>invitation URL</em> that
will allow you sign up for the homework assignment on GitHub, and which will
result in the creation of a repository called
<code class="docutils literal notranslate"><span class="pre">2021-hw6-GITHUB_USERNAME</span></code> inside our <code class="docutils literal notranslate"><span class="pre">uchicago-cmsc22000</span></code> organization
on GitHub.</p>
<p>Your repository will be seeded with some files for the homework
and, more specifically, will contain the same files we provided for Homework
#5 (an implementation of libgeometry).</p>
</div>
<div class="section" id="task-1-building-your-code-with-ci">
<h2>Task 1: Building your code with CI<a class="headerlink" href="#task-1-building-your-code-with-ci" title="Permalink to this headline">¶</a></h2>
<p>In most CI systems, we will want to specify a series of actions that
need to happen automatically whenever any commits are pushed to the
repository. For example, we may need to build the code in our
repository, and run some tests. These actions are typically referred to
as <em>jobs</em>. A CI system will keep a record of all the jobs it runs, and
will typically notify you if a job fails.</p>
<p>GitHub Actions groups jobs into “workflows”, and it is possible to specify
multiple workflows for the same repository. For example, we could have
one workflow to build our code, and another workflow to generate an
installable package for our software.</p>
<p>Workflows are specified using the YAML file format, a text-based
file format that is commonly used for configuration files (fun fact:
YAML is a recursive acronym that stands for “YAML Ain’t Markup Language”). We’ll be
showing some of the basic syntax you need in this homework, but you do not
need to know YAML in depth to be able to write workflow configuration
files in YAML.</p>
<p>We’ll start by looking at a simple GitHub Actions workflow file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">Build</span> <span class="ow">and</span> <span class="n">Test</span> <span class="n">libgeometry</span>

<span class="n">on</span><span class="p">:</span> <span class="p">[</span><span class="n">push</span><span class="p">]</span>

<span class="n">jobs</span><span class="p">:</span>
  <span class="n">build</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">test</span><span class="p">:</span>

    <span class="n">runs</span><span class="o">-</span><span class="n">on</span><span class="p">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span>

    <span class="n">steps</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">uses</span><span class="p">:</span> <span class="n">actions</span><span class="o">/</span><span class="n">checkout</span><span class="nd">@v2</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Install</span> <span class="n">Criterion</span>
      <span class="n">run</span><span class="p">:</span> <span class="o">|</span>
       <span class="n">sudo</span> <span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="o">-</span><span class="n">y</span> <span class="n">ppa</span><span class="p">:</span><span class="n">snaipewastaken</span><span class="o">/</span><span class="n">ppa</span>
       <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span> <span class="o">-</span><span class="n">q</span>
       <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">qy</span> <span class="n">criterion</span> <span class="n">criterion</span><span class="o">-</span><span class="n">dev</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Build</span> <span class="n">libgeometry</span>
      <span class="n">working</span><span class="o">-</span><span class="n">directory</span><span class="p">:</span> <span class="n">libgeometry</span><span class="o">/</span>
      <span class="n">run</span><span class="p">:</span> <span class="o">|</span>
        <span class="n">make</span> <span class="n">clean</span>
        <span class="n">make</span> <span class="nb">all</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Build</span> <span class="n">tests</span>
      <span class="n">working</span><span class="o">-</span><span class="n">directory</span><span class="p">:</span> <span class="n">libgeometry</span><span class="o">/</span>
      <span class="n">run</span><span class="p">:</span> <span class="n">make</span> <span class="n">tests</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Run</span> <span class="n">tests</span>
      <span class="n">working</span><span class="o">-</span><span class="n">directory</span><span class="p">:</span> <span class="n">libgeometry</span><span class="o">/</span>
      <span class="n">run</span><span class="p">:</span> <span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">libgeometry</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>Create a <code class="docutils literal notranslate"><span class="pre">.github</span></code> directory in your repository, and a <code class="docutils literal notranslate"><span class="pre">workflows</span></code> directory inside
that directory. Save the above file as <code class="docutils literal notranslate"><span class="pre">.github/workflows/build-and-test.yml</span></code>,
but don’t commit/push it just yet.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Files and directories that start with a period, like <code class="docutils literal notranslate"><span class="pre">.github</span></code>, are
hidden by default on a UNIX system. This means the file won’t appear if
you use <code class="docutils literal notranslate"><span class="pre">ls</span></code> from the terminal; you will need to include the <code class="docutils literal notranslate"><span class="pre">-a</span></code>
option to be able to see it (i.e., <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-a</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ls</span></code>, and
<code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-al</span></code> instead of <code class="docutils literal notranslate"><span class="pre">ls</span> <span class="pre">-l</span></code>). If you are using a graphical file
browser, you may need to select a “Show Hidden Files” option somewhere
to be able to see the file.</p>
</div>
<p>Let’s take a look at what the contents of this file mean. The file
starts with two general configuration options:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">name:</span> <span class="pre">Build</span> <span class="pre">and</span> <span class="pre">Test</span> <span class="pre">libgeometry</span></code> specifies a name for the workflow.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">on:</span> <span class="pre">[push]</span></code> specifies that the workflow should be run whenever we
push to the repository. The <code class="docutils literal notranslate"><span class="pre">on</span></code> option can be used to specify more
fine-grained events (e.g., we could specify a workflow that only runs
when we push to a specific branch)</p></li>
</ul>
<p>After that, we have a <code class="docutils literal notranslate"><span class="pre">jobs:</span></code> option where we can specify the jobs
that make up this workflow. In this workflow, we are only specifying
a single job called <code class="docutils literal notranslate"><span class="pre">build-and-test</span></code>.</p>
<p>The first option of the job (<code class="docutils literal notranslate"><span class="pre">runs-on:</span> <span class="pre">ubuntu-16.04</span></code>) specifies
that the job should be run on an Ubuntu 16.04 environment. We can’t specify
arbitrary environments here, though; a CI system will typically
have a limited set of environments they support (for GitHub Actions,
you can see the list of supported environments
<a class="reference external" href="https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#supported-runners-and-hardware-resources">here</a>)</p>
<p>Next, the <code class="docutils literal notranslate"><span class="pre">steps</span></code> option specifies the exact steps that should
be performed as part of this job. You’ll notice that all of them,
except the first one, have two options in common: <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">run</span></code>.
Those steps specify the commands that have to be run as part of the
workflow (notice how these are just commands that you would run
from the terminal if you were building the code manually). Some
of these steps also have a <code class="docutils literal notranslate"><span class="pre">working-directory</span></code> option, which
specifies the directory the commands have to be run from.</p>
<p>The first step is different. GitHub Actions actually allows developers to
publish actions that other developers
can re-use in their workflows, and we are reusing an action provided
by GitHub: the <code class="docutils literal notranslate"><span class="pre">actions/checkout&#64;v2</span></code> action. This action simply
clones our repository before running the rest of the commands
in the job.</p>
<p>Let’s take a closer look at what the other steps do.</p>
<p>First of all, libgeometry uses the Criterion library to run unit tests, so
we need to install that library before building our code.
The following step uses Ubuntu’s <code class="docutils literal notranslate"><span class="pre">apt</span></code> command to install Criterion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Install</span> <span class="n">Criterion</span>
  <span class="n">run</span><span class="p">:</span> <span class="o">|</span>
   <span class="n">sudo</span> <span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="o">-</span><span class="n">y</span> <span class="n">ppa</span><span class="p">:</span><span class="n">snaipewastaken</span><span class="o">/</span><span class="n">ppa</span>
   <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span> <span class="o">-</span><span class="n">q</span>
   <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">qy</span> <span class="n">criterion</span> <span class="n">criterion</span><span class="o">-</span><span class="n">dev</span>
</pre></div>
</div>
<p>Next, we actually build libgeometry. Notice how we run <code class="docutils literal notranslate"><span class="pre">make</span> <span class="pre">clean</span></code>
first: this is considered good practice, because it ensures our build
starts from a clean slate, in case we inadvertently committed any binary
files to our repository that would interfere with the build.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Build</span> <span class="n">libgeometry</span>
  <span class="n">working</span><span class="o">-</span><span class="n">directory</span><span class="p">:</span> <span class="n">libgeometry</span><span class="o">/</span>
  <span class="n">run</span><span class="p">:</span> <span class="o">|</span>
    <span class="n">make</span> <span class="n">clean</span>
    <span class="n">make</span> <span class="nb">all</span>
</pre></div>
</div>
<p>As a separate step, we build the tests. It is also good to place this in
its own step so that, if building the library or the tests fails,
we can easily distinguish which one failed just by seeing what step
of the job failed.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Build</span> <span class="n">tests</span>
  <span class="n">working</span><span class="o">-</span><span class="n">directory</span><span class="p">:</span> <span class="n">libgeometry</span><span class="o">/</span>
  <span class="n">run</span><span class="p">:</span> <span class="n">make</span> <span class="n">tests</span>
</pre></div>
</div>
<p>Finally, we run the tests:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Run</span> <span class="n">tests</span>
  <span class="n">working</span><span class="o">-</span><span class="n">directory</span><span class="p">:</span> <span class="n">libgeometry</span><span class="o">/</span>
  <span class="n">run</span><span class="p">:</span> <span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">libgeometry</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>Take into account that we could’ve also run all the commands inside a single
<code class="docutils literal notranslate"><span class="pre">run</span></code> step:
<code class="docutils literal notranslate"><span class="pre">script</span></code> phase:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">Build</span> <span class="ow">and</span> <span class="n">Test</span> <span class="n">libgeometry</span>

<span class="n">on</span><span class="p">:</span> <span class="p">[</span><span class="n">push</span><span class="p">]</span>

<span class="n">jobs</span><span class="p">:</span>
  <span class="n">build</span><span class="o">-</span><span class="ow">and</span><span class="o">-</span><span class="n">test</span><span class="p">:</span>

    <span class="n">runs</span><span class="o">-</span><span class="n">on</span><span class="p">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span>

    <span class="n">steps</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">uses</span><span class="p">:</span> <span class="n">actions</span><span class="o">/</span><span class="n">checkout</span><span class="nd">@v2</span>

    <span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Build</span> <span class="ow">and</span> <span class="n">Test</span>
      <span class="n">working</span><span class="o">-</span><span class="n">directory</span><span class="p">:</span> <span class="n">libgeometry</span><span class="o">/</span>
      <span class="n">run</span><span class="p">:</span> <span class="o">|</span>
        <span class="n">sudo</span> <span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="o">-</span><span class="n">y</span> <span class="n">ppa</span><span class="p">:</span><span class="n">snaipewastaken</span><span class="o">/</span><span class="n">ppa</span>
        <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span> <span class="o">-</span><span class="n">q</span>
        <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">qy</span> <span class="n">criterion</span> <span class="n">criterion</span><span class="o">-</span><span class="n">dev</span>
        <span class="n">make</span> <span class="n">clean</span>
        <span class="n">make</span> <span class="nb">all</span>
        <span class="n">make</span> <span class="n">tests</span>
        <span class="n">tests</span><span class="o">/</span><span class="n">test</span><span class="o">-</span><span class="n">libgeometry</span> <span class="o">--</span><span class="n">verbose</span>
</pre></div>
</div>
<p>However, it is considered good practice to separate these commands into
separate steps. In more complex builds, it can be useful to
know exactly what step of a given job failed.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can find more information about GitHub Actions in the <a class="reference external" href="https://docs.github.com/en/actions">GitHub Actions
Documentation</a>, and a specification of
their worflow file format in the <a class="reference external" href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions">Workflow syntax for GitHub Actions</a> page.
You don’t need to refer to
these resources right now, but may need to consult them later in the
homework.</p>
</div>
<p>Go ahead and commit the <code class="docutils literal notranslate"><span class="pre">.github/workflows/build-and-test.yml</span></code> file, and
push it to GitHub. GitHub will
detect that your repository has a workflow file and
will run the job specified in that workflow.
You can see the status of the workflow by clicking on the
Actions tab of your repository:</p>
<div class="figure align-default">
<img alt="Actions tab in GitHub" src="../_images/hw6-github-actions-tab.png" />
</div>
<p>You should see something like this:</p>
<div class="figure align-default">
<img alt="GitHub Actions workflows" src="../_images/hw6-workflows.png" />
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you see a yellow icon next to your workflow, that means the workflow is still running.
It should not take more than a few minutes to complete.</p>
</div>
<p>Each row corresponds to an individual <em>run</em> of a workflow (identified by the commit
that triggered that run). As you push more commits
to your repository, you’ll see more entries in this table.</p>
<p>If you click on the commit name, you’ll see more details about the workflow’s
jobs (in this case, we only have one job, <code class="docutils literal notranslate"><span class="pre">build-and-test</span></code>):</p>
<div class="figure align-default">
<img alt="GitHub Actions workflow jobs" src="../_images/hw6-workflow-jobs.png" />
</div>
<p>Make a note of the URL of this page, which should look something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">uchicago</span><span class="o">-</span><span class="n">cmsc22000</span><span class="o">/</span><span class="mi">2021</span><span class="o">-</span><span class="n">hw6</span><span class="o">-</span><span class="n">GITHUB_USERNAME</span><span class="o">/</span><span class="n">actions</span><span class="o">/</span><span class="n">runs</span><span class="o">/</span><span class="n">XXXXXXXXXX</span>
</pre></div>
</div>
<p>Where <code class="docutils literal notranslate"><span class="pre">XXXXXXXXXX</span></code> will be a number. Later in the homework, we will be asking you
to provide this URL, as well as the
URLs of future runs. To double-check that you’re providing the right URL, make sure
that it looks like the one above.</p>
<p>If we click on the <code class="docutils literal notranslate"><span class="pre">build-and-test</span></code> job, we can see more details on that job,
including the list of steps that were run in that job:</p>
<div class="figure align-default">
<img alt="GitHub Actions workflow job details" src="../_images/hw6-workflow-job.png" />
</div>
<p>And, if we click on an individual step, we can see the output of any commands
run in that step.</p>
<div class="figure align-default">
<img alt="GitHub Actions step details" src="../_images/hw6-workflow-job-steps.png" />
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If a workflow is running (and not completed), you can still navigate to these
pages to observe the execution of the various steps.</p>
</div>
<p>Take into account that you can also access your latest workflow run (even if
it’s in progress) through the main page of your GitHub repository.
In your repository, there will be a
small icon (a green check mark for a successful run, a yellow circle
for a run in progress, and a red X for a failed run) in the top
right of your list of files. If you click on it, it will show more
information about the run:</p>
<div class="figure align-default">
<img alt="Build status on GitHub" src="../_images/hw6-build-status.png" />
</div>
<p>If you click on “Details”, it will take you directly to the page with
more details about that particular run.</p>
<p>Now, do the following:</p>
<ul class="simple">
<li><p>[10 points] Take the URL of the run you just produced, and paste it
into Gradescope (under “Task 1.1: Successful run”)</p></li>
<li><p>[10 points] Make a change to the libgeometry code that will prevent
it from compiling. Commit and push that change; your run should
eventually fail (make sure to double-check that the “Build libgeometry”
step is failing). Paste the URL of the failed run on Gradescope
(under “Task 1.2: Failed run (compiling)”)</p></li>
<li><p>[10 points] Fix the change you made, and make another change that
will make the tests fail. Commit and push that change; your run
should eventually fail (make sure to double-check that the “Run tests”
step is failing). Paste the URL of the failed run on
Gradescope (under “Task 1.3: Failed run (tests)”)</p></li>
</ul>
<p>Before moving on to the next task, make sure to fix the change you just
made. Your build should succeed before moving on to the next tasks.</p>
</div>
<div class="section" id="task-2-multiple-jobs">
<h2>Task 2: Multiple jobs<a class="headerlink" href="#task-2-multiple-jobs" title="Permalink to this headline">¶</a></h2>
<p>In the previous task we saw that GitHub Actions can build our code and run
the tests, and alert us to any issues when doing so. However, our job
was running specifically in an Ubuntu 16.04 environment. What if our
code doesn’t compile in other environments? CI systems can also help us
with this, as they often provide mechanisms to easily build our code in
multiple environments. For example, we may want to build our code in
multiple Ubuntu versions, or using different compilers.</p>
<p>In GitHub Actions, we can do this by specifying a <em>matrix</em> of job
configurations. For example, add this option to your <code class="docutils literal notranslate"><span class="pre">build-and-test</span></code>
job:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">strategy</span><span class="p">:</span>
  <span class="n">matrix</span><span class="p">:</span>
    <span class="n">os</span><span class="p">:</span> <span class="p">[</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span><span class="p">,</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span><span class="p">]</span>
    <span class="n">compiler</span><span class="p">:</span> <span class="p">[</span><span class="n">gcc</span><span class="p">,</span> <span class="n">clang</span><span class="p">]</span>
</pre></div>
</div>
<p>Commit and push this change. You’ll notice that your workflow now
produces four jobs, corresponding to every combination of the <code class="docutils literal notranslate"><span class="pre">os</span></code>
and <code class="docutils literal notranslate"><span class="pre">compiler</span></code> values shown above.</p>
<p>However, the <code class="docutils literal notranslate"><span class="pre">matrix</span></code> option above doesn’t actually affect the
running environment or compiler used in the jobs (for example,
if you click through the details of the Ubuntu 18.04 clang job,
you’ll see that Ubuntu 16.04 still appears in the “Set up job”
step, under “Operating System”, and that the build steps still use GCC).</p>
<p>The <code class="docutils literal notranslate"><span class="pre">matrix</span></code> option simply defines variables we can use in our
workflow file, and which get substituted for each individual job.
In this case, the variables are <code class="docutils literal notranslate"><span class="pre">${{</span> <span class="pre">matrix.os</span> <span class="pre">}}</span></code> and <code class="docutils literal notranslate"><span class="pre">${{</span> <span class="pre">matrix.compiler</span> <span class="pre">}}</span></code>.
So, if we replace this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">runs</span><span class="o">-</span><span class="n">on</span><span class="p">:</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span>
</pre></div>
</div>
<p>With this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>runs-on: ${{ matrix.os }}
</pre></div>
</div>
<p>Each run will use the appropriate operating system. Make the above
change and commit/push the change to give it a try.</p>
<ul class="simple">
<li><p>[10 points] Take the URL of the run you just produced, and paste it
into Gradescope (under “Task 2.1: Multiple operating systems”).</p></li>
</ul>
<p>However, our builds are still using GCC in every job. Unfortunately,
the workflow file doesn’t have a convenient “tell Make to use this compiler”
option, so this requires a bit more work.</p>
<p>First of all, we will need to modify our Makefile. Notice how the
<code class="docutils literal notranslate"><span class="pre">libgeometry/Makefile</span></code> and <code class="docutils literal notranslate"><span class="pre">libgeometry/tests/Makefile</span></code> files
hardcode <code class="docutils literal notranslate"><span class="pre">gcc</span></code> as the compiler:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">CC</span> <span class="o">=</span> <span class="n">gcc</span>
</pre></div>
</div>
<p>Simply remove this line from both Makefiles, and try running the
following from inside the <code class="docutils literal notranslate"><span class="pre">libgeometry</span></code> directory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ CC=clang make
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">CC=clang</span></code> defines an <em>environment variable</em> that is passed along
to <cite>make</cite> (this is not a Make-specific feature; many UNIX commands
will check the values of certain environment variables).</p>
<p>Notice how you will still be able to run <code class="docutils literal notranslate"><span class="pre">make</span></code> without the <code class="docutils literal notranslate"><span class="pre">CC</span></code>
environment variable:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ make clean
$ make
</pre></div>
</div>
<p>This is because, if you do not define <code class="docutils literal notranslate"><span class="pre">CC</span></code> in the Makefile,
Make will simply use a default value.</p>
<p>Finally, take into account that you could also do something like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ export CC=clang
$ make
</pre></div>
</div>
<p>The difference is that using <code class="docutils literal notranslate"><span class="pre">export</span></code> sets the value of the <code class="docutils literal notranslate"><span class="pre">CC</span></code>
variable for all subsequent commands, while <code class="docutils literal notranslate"><span class="pre">CC=clang</span> <span class="pre">make</span></code>
only sets it for that specific command that is being run (<code class="docutils literal notranslate"><span class="pre">make</span></code>).</p>
<p>Your task is to figure out how to specify environment variables as part
of a workflow job. Remember that you can find the workflow format
documentation <a class="reference external" href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions">here</a>
and that you’re welcome to look for the answer through external
sources, as long as you cite your sources.</p>
<ul class="simple">
<li><p>[20 points] Modify the Makefile as described above, and update
your workflow file so that the libgeometry code and the tests
are built with the right compiler. Take the URL of the run
you just produced, and paste it
into Gradescope (under “Task 2.2: Multiple compilers”).</p></li>
</ul>
</div>
<div class="section" id="task-3-supporting-different-environments">
<h2>Task 3: Supporting Different Environments<a class="headerlink" href="#task-3-supporting-different-environments" title="Permalink to this headline">¶</a></h2>
<p>You may have noticed that Ubuntu 20.04 (the latest “Long Term Support”
version of Ubuntu) was conspicuously missing from the list of operating
systems we were building libgeometry in. This is because the Criterion
library does not provide installable packages for Ubuntu 20.04, which
means the “Install Criterion” step we defined (which uses Ubuntu’s <code class="docutils literal notranslate"><span class="pre">apt</span></code> command to fetch
and install the Criterion package) will fail on Ubuntu 20.04.</p>
<p>You can give it a try by changing this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="p">:</span> <span class="p">[</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span><span class="p">,</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span><span class="p">]</span>
</pre></div>
</div>
<p>To this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">os</span><span class="p">:</span> <span class="p">[</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span><span class="p">,</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">20.04</span><span class="p">]</span>
</pre></div>
</div>
<p>You’ll notice that the “Install Criterion” step fails for the Ubuntu 20.04 runs.</p>
<p>Fortunately, we can just build Criterion from its source code.
However, we’d like to do this <em>only</em> when building our code
for Ubuntu 20.04 (building Criterion from scratch takes longer
than installing a package, so we’d like to continue to use
the installable packages whenever possible).</p>
<p>So, we’re going to end up with two possible installation steps
for Criterion:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Install</span> <span class="n">Criterion</span> <span class="p">(</span><span class="n">Ubuntu</span> <span class="o">&lt;</span> <span class="mf">20.04</span><span class="p">)</span>
  <span class="n">run</span><span class="p">:</span> <span class="o">|</span>
   <span class="n">sudo</span> <span class="n">add</span><span class="o">-</span><span class="n">apt</span><span class="o">-</span><span class="n">repository</span> <span class="o">-</span><span class="n">y</span> <span class="n">ppa</span><span class="p">:</span><span class="n">snaipewastaken</span><span class="o">/</span><span class="n">ppa</span>
   <span class="n">sudo</span> <span class="n">apt</span> <span class="n">update</span> <span class="o">-</span><span class="n">q</span>
   <span class="n">sudo</span> <span class="n">apt</span> <span class="n">install</span> <span class="o">-</span><span class="n">qy</span> <span class="n">criterion</span> <span class="n">criterion</span><span class="o">-</span><span class="n">dev</span>

<span class="o">-</span> <span class="n">name</span><span class="p">:</span> <span class="n">Install</span> <span class="n">Criterion</span> <span class="p">(</span><span class="n">Ubuntu</span> <span class="o">&gt;=</span> <span class="mf">20.04</span><span class="p">)</span>
  <span class="n">run</span><span class="p">:</span> <span class="o">|</span>
    <span class="n">git</span> <span class="n">clone</span> <span class="o">--</span><span class="n">recursive</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">github</span><span class="o">.</span><span class="n">com</span><span class="o">/</span><span class="n">Snaipe</span><span class="o">/</span><span class="n">Criterion</span>
    <span class="n">cd</span> <span class="n">Criterion</span>
    <span class="n">git</span> <span class="n">checkout</span> <span class="n">master</span>
    <span class="n">cmake</span> <span class="o">-</span><span class="n">DCMAKE_INSTALL_PREFIX</span><span class="p">:</span><span class="n">PATH</span><span class="o">=/</span><span class="n">usr</span> <span class="o">-</span><span class="n">B</span> <span class="n">build</span><span class="o">/</span>
    <span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">build</span><span class="o">/</span>
    <span class="n">sudo</span> <span class="n">make</span> <span class="o">-</span><span class="n">C</span> <span class="n">build</span><span class="o">/</span> <span class="n">install</span>
</pre></div>
</div>
<p>Your task is to figure out how to ensure that the first step is only
run if the operating system is <code class="docutils literal notranslate"><span class="pre">ubuntu-16.04</span></code>, and the second
step is only run if the operating system is <code class="docutils literal notranslate"><span class="pre">ubuntu-20.04</span></code>.
Note: you must do this without modifying the <code class="docutils literal notranslate"><span class="pre">run</span></code> option.
Like before, remember that you can find the workflow format
documentation <a class="reference external" href="https://docs.github.com/en/actions/reference/workflow-syntax-for-github-actions">here</a>
and that you’re welcome to look for the answer through external
sources, as long as you cite your sources.</p>
<ul class="simple">
<li><p>[20 points] Take the URL of the run you just produced, and paste it
into Gradescope (under “Task 3: Supporting Different Environments”).</p></li>
</ul>
</div>
<div class="section" id="task-4-tweaking-the-matrix">
<h2>Task 4: Tweaking the Matrix<a class="headerlink" href="#task-4-tweaking-the-matrix" title="Permalink to this headline">¶</a></h2>
<p>One of the advantages of specifying a matrix of configurations is that
it can allow us to very easily verify that our code works across
multiple combinations of different options. For example, let’s
say we defined the following matrix:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">strategy</span><span class="p">:</span>
  <span class="n">matrix</span><span class="p">:</span>
    <span class="n">os</span><span class="p">:</span> <span class="p">[</span><span class="n">ubuntu</span><span class="o">-</span><span class="mf">16.04</span><span class="p">,</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">18.04</span><span class="p">,</span> <span class="n">ubuntu</span><span class="o">-</span><span class="mf">20.04</span><span class="p">]</span>
    <span class="n">compiler</span><span class="p">:</span> <span class="p">[</span><span class="n">gcc</span><span class="p">,</span> <span class="n">clang</span><span class="p">]</span>
</pre></div>
</div>
<p>This would run six different configurations. However, let’s say
we’re only interested in testing our code with both GCC and clang
in the latest version of Ubuntu (for prior versions, we’ll just
test it with GCC). So, for avoidance of doubt, you would end
up with four jobs:</p>
<ul class="simple">
<li><p>Ubuntu 16.04 with GCC</p></li>
<li><p>Ubuntu 18.04 with GCC</p></li>
<li><p>Ubuntu 20.04 with GCC</p></li>
<li><p>Ubuntu 20.04 with clang</p></li>
</ul>
<p>Figure out a way to run only the above jobs. For full credit,
you must do so in a way that does not involve writing out the configuration
for four separate jobs (either by writing four separate jobs, or by
creating a matrix that specifies four distinct configurations). Instead, you
should look for a way to selectively add/remove jobs from an existing matrix.
Also, take into account that, depending on
how you solved Task 3, you may have to further tweak your
Task 3 solution to get it to work with all these configurations.</p>
<ul class="simple">
<li><p>[20 points] Take the URL of the run you just produced, and paste it
into Gradescope (under “Task 4: Tweaking the Matrix”).</p></li>
</ul>
</div>
</div>
<div class="section" id="submitting-your-homework">
<h1>Submitting your homework<a class="headerlink" href="#submitting-your-homework" title="Permalink to this headline">¶</a></h1>
<p>Please note that you will not be submitting your code through
Gradescope. Instead, make sure that you have provided the URLs to your
runs through Gradescope. That said, we still need you to push your
code in case we need to look at any of your code (but we will not be
grading the code itself).</p>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011-2021, The University of Chicago.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.0.3.<br/>
    </p>
  </div>
</footer>
  </body>
</html>