
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Creating your lab repository &#8212; CMSC 22000 - Introduction to Software Development</title>

    <link rel="stylesheet" href="../_static/bootstrap-sphinx.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/chiweb.css" />
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
<meta charset='utf-8'>
<meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1'>
<meta name="apple-mobile-web-app-capable" content="yes">
<script type="text/javascript" src="../_static/js/jquery-1.11.0.min.js "></script>
<script type="text/javascript" src="../_static/js/jquery-fix.js "></script>
<script type="text/javascript" src="../_static/bootstrap-3.3.7/js/bootstrap.min.js "></script>
<script type="text/javascript" src="../_static/bootstrap-sphinx.js "></script>

  </head><body>


  <div id="navbar" class="navbar navbar-default navbar-fixed-top">
    <div class="container">
      <div class="navbar-header">
        <!-- .btn-navbar is used as the toggle for collapsed navbar content -->
        <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".nav-collapse">
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
        <a class="navbar-brand" href="../index.html">
          CMSC 22000 - Introduction to Software Development</a>
        <span class="navbar-text navbar-version pull-left"><b></b></span>
      </div>

        <div class="collapse navbar-collapse nav-collapse">
          <ul class="nav navbar-nav">
            
            
              
              
            
            
            
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Course Information <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../syllabus.html">Syllabus</a></li>
        <li><a href="../calendar.html">Calendar</a></li>
        <li><a href="../code_of_conduct.html">TA/Grader Code of Conduct</a></li>
    </ul>
</li>
<li><a href="index.html">Homework</a></li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Project <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../project/index.html">Introduction</a></li>
        <li><a href="../project/chiventure.html">chiventure</a></li>
        <li><a href="../project/policies.html">Policies</a></li>
        <li><a href="../project/features.html">Features</a></li>
        <li><a href="../project/warmup.html">Design Warm-Up Exercise</a></li>
    </ul>
</li>
<li class="dropdown">
    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Resources <span class="caret"></span></a>
    <ul class="dropdown-menu">
        <li><a href="../resources/faq.html">CS 220 FAQs</a></li>
        <li><a href="../resources/tutorials/index.html">Tutorials</a></li>
        <li><a href="https://uchicago-cs.github.io/dev-guide/" target="_blank">UChicago CS Developer's Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="https://uchicago-cs.github.io/debugging-guide" target="_blank">The Debugging Guide <i class="fa fa-external-link"></i></a></li>
        <li><a href="../resources/other.html">Other Resources</a></li>
    </ul>
</li>

            
          </ul>

          

        </div>
    </div>
  </div>

<div class="container">
  <div class="row">
    <div class="body col-md-12 content" role="main">
      
  <p><strong>Due:</strong> Wednesday, May 27th, 8pm</p>
<p>Last week, you learned about Continuous Integration, which deals with
how application code makes it to the master branch. But how do our
applications make it to the <em>real world</em>, where other people can use
them?</p>
<p>Deployment refers to the processes by which software systems are made
available for use (a related term, <em>delivery</em>, refers to making software
available specifically to end-users). The exact deployment pipeline can
vary from one project to another. For example, in a large financial
company, deploying business management software might require system
architects to come and physically upload software on the machines. On
the other hand, if you’re deploying a small web application, you just
need a way to get your application from your computer to a server where
other users can access it.</p>
<p>In this lab, you will deploy an application to
<a class="reference external" href="https://www.heroku.com/">Heroku</a>, one of the most popular services
for hosting web apps. More specifically, you’ll be deploying HelloApp,
the small <a class="reference external" href="http://flask.pocoo.org/">Flask</a> web application we
demonstrated in this week’s lectures (you can see our deployed version
here: <a class="reference external" href="https://cs220-helloapp.herokuapp.com/">https://cs220-helloapp.herokuapp.com/</a>). Don’t worry: while the app
is implemented in Python, no Python knowledge is necessary for this lab.</p>
<div class="section" id="creating-your-lab-repository">
<h1>Creating your lab repository<a class="headerlink" href="#creating-your-lab-repository" title="Permalink to this headline">¶</a></h1>
<p>Like previous labs, we will provide you with an <em>invitation URL</em> that
will allow you sign up for the lab assignment on GitHub, and which will
result in the creation of a repository called
<code class="docutils literal notranslate"><span class="pre">2020-lab7-GITHUB_USERNAME</span></code> inside our <code class="docutils literal notranslate"><span class="pre">cmsc22000-labs</span></code> organization
on GitHub. Your repository will be seeded with some files for the lab
and, more specifically, will contain the code for HelloApp.</p>
<div class="section" id="task-1-create-a-heroku-app">
<h2>Task 1: Create a Heroku App<a class="headerlink" href="#task-1-create-a-heroku-app" title="Permalink to this headline">¶</a></h2>
<p>[20 points]</p>
<p>Heroku is a common service used to host web applications. For this task
you’ll sign up for a (free) account and use it to deploy an app with an
Internet-reachable URL.</p>
<ol class="arabic simple">
<li><p>Go to <a class="reference external" href="https://signup.heroku.com/login">https://signup.heroku.com/login</a></p></li>
<li><p>Sign up and mark your “role” as “student”. You will need to confirm
your account, and then create a password.</p></li>
</ol>
<p>Once you’ve created your account, you’re ready to create a Heroku app.</p>
<ol class="arabic simple">
<li><p>Go to your dashboard, <a class="reference external" href="https://dashboard.heroku.com/apps">https://dashboard.heroku.com/apps</a></p></li>
<li><p>Click the button that says “New” and then click on “Create new app”</p></li>
<li><p>Under “app-name” title your app <code class="docutils literal notranslate"><span class="pre">CNETID-cs220-lab7</span></code> (where
<code class="docutils literal notranslate"><span class="pre">CNETID</span></code> should be replaced with your CNetID). This means that the
url for your app will be <code class="docutils literal notranslate"><span class="pre">https://CNETID-cs220-lab7.herokuapp.com</span></code></p></li>
</ol>
<p>You’ve created your app! But navigate to
<code class="docutils literal notranslate"><span class="pre">https://CNETID-cs220-lab7.herokuapp.com</span></code>. As you can see, there’s
nothing there. In the coming tasks we will get HelloApp up and running
on this URL.</p>
<p>Before continuing, enter the URL of your Heroku app on Gradescope.</p>
</div>
<div class="section" id="task-2-deploy-using-heroku-cli">
<h2>Task 2: Deploy using Heroku CLI<a class="headerlink" href="#task-2-deploy-using-heroku-cli" title="Permalink to this headline">¶</a></h2>
<p>[20 points]</p>
<p>In class, we saw that we can deploy an app to Heroku simply by pushing
to their Git repository. Your local <code class="docutils literal notranslate"><span class="pre">2020-lab7-GITHUB_USERNAME</span></code>
repository is currently configured to push only to GitHub, so we need to
set it up to also push to Heroku. We can do this using a command-line
tool provided by Heroku.</p>
<p>First, you’ll need to log into Heroku like this (make sure you run this
command <em>inside</em> your <code class="docutils literal notranslate"><span class="pre">2020-lab7-GITHUB_USERNAME</span></code> directory):</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ heroku login
</pre></div>
</div>
<p>{{% warning %}} The <code class="docutils literal notranslate"><span class="pre">heroku</span></code> command is available on the CSIL machines
and the <code class="docutils literal notranslate"><span class="pre">linux.cs</span></code> servers.</p>
<p>If you are running inside the CS VM, then you will need to install Flask
and the <code class="docutils literal notranslate"><span class="pre">heroku</span></code> command by running the following:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ sudo -H pip3 install flask
$ sudo snap install --classic heroku
</pre></div>
</div>
<p>If you are using the Headless VM setup, take into account that the
<code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">login</span></code> command will attempt to open a browser to log you into
Heroku, which is not possible from headless mode. Instead, the command
will print out a URL, which you will have to manually copy/paste into a
browser in your computer. {{% /warning %}}</p>
<p>The instructions for deploying using the CLI are located at
<code class="docutils literal notranslate"><span class="pre">https://dashboard.heroku.com/apps/CNETID-cs220-lab7/deploy/heroku-git</span></code>
(under “Deploy using Heroku Git”). We already have a git repository, so
we’ll follow the instructions for <em>Existing Git Repository</em>.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ heroku git:remote -a CNETID-cs220-lab7
</pre></div>
</div>
<p>So, we’ve set up Heroku for this app, but we haven’t deployed it yet…
Navigate to your app’s webpage, and you’ll see nothing is there.</p>
<p>In order to deploy, you should use:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ git push heroku master
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">heroku</span> <span class="pre">git:remote</span></code> command you ran above added the <code class="docutils literal notranslate"><span class="pre">heroku</span></code>
remote to your local repository, and pushing to it means that Heroku’s
servers will receive your code for the first time. The deployment will
take about a minute or so and, once it’s done, you should see a message
like this:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>remote: -----&gt; Launching...
remote:        Released v3
remote:        https://CNETID-cs220-lab7.herokuapp.com/ deployed to Heroku
remote:
remote: Verifying deploy... <span class="k">done</span>.
To https://git.heroku.com/CNETID-cs220-lab7.git
 * <span class="o">[</span>new branch<span class="o">]</span>      master -&gt; master
</pre></div>
</div>
<p>Go ahead and go to <code class="docutils literal notranslate"><span class="pre">https://CNETID-cs220-lab7.herokuapp.com/</span></code>.
HelloApp should now be running correctly at that URL.</p>
<p>The version you just deployed happens to be a correct version of the
app. We actually have a few tests that will run some basic checks to
make sure the app is behaving as intended. You can run this tests simply
by running this:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ pytest
</pre></div>
</div>
<p>This should produce an output like this:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">======================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=======================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /var/tmp/borja/cs220-helloapp-2019, inifile:
plugins: metadata-1.7.0, json-0.4.0, html-1.17.0
collected <span class="m">2</span> items

tests/test_greeting.py ..                                                                  <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">====================================</span> <span class="m">2</span> passed in <span class="m">0</span>.02 <span class="nv">seconds</span> <span class="o">====================================</span>
</pre></div>
</div>
<p>Now, let’s break our app. Edit the file <code class="docutils literal notranslate"><span class="pre">hello/templates/index.html</span></code>
and replace <code class="docutils literal notranslate"><span class="pre">Hello</span></code> with <code class="docutils literal notranslate"><span class="pre">Howdy</span></code>. If you re-run the tests, one test
will pass, but another will fail:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span><span class="o">======================================</span> <span class="nb">test</span> session <span class="nv">starts</span> <span class="o">=======================================</span>
platform linux -- Python <span class="m">3</span>.5.2, pytest-3.5.1, py-1.5.3, pluggy-0.6.0
rootdir: /var/tmp/borja/cs220-helloapp-2019, inifile:
plugins: metadata-1.7.0, json-0.4.0, html-1.17.0
collected <span class="m">2</span> items

tests/test_greeting.py .F                                                                  <span class="o">[</span><span class="m">100</span>%<span class="o">]</span>

<span class="o">============================================</span> <span class="nv">FAILURES</span> <span class="o">============================================</span>
_________________________________________ test_greeting __________________________________________

<span class="nv">client</span> <span class="o">=</span> &lt;FlaskClient &lt;Flask <span class="s1">&#39;hello.main&#39;</span>&gt;&gt;

    def test_greeting<span class="o">(</span>client<span class="o">)</span>:
        <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">        Test that we get the correct greeting</span>
<span class="s2">        if we submit the form.</span>
<span class="s2">        &quot;&quot;&quot;</span>

        <span class="nv">name</span> <span class="o">=</span> b<span class="s2">&quot;Random J. Hacker&quot;</span>
        <span class="nv">greeting</span> <span class="o">=</span> GREETING + b<span class="s2">&quot;, &quot;</span> + name + b<span class="s2">&quot;!&quot;</span>

        <span class="nv">rv</span> <span class="o">=</span> client.post<span class="o">(</span><span class="s2">&quot;/&quot;</span>, <span class="nv">data</span><span class="o">={</span><span class="s2">&quot;name&quot;</span>: name<span class="o">})</span>

        <span class="c1"># Test that the resulting page contains the app name</span>
        <span class="c1"># and the correct greeting.</span>
        assert APPNAME in rv.data
&gt;       assert greeting in rv.data
E       assert b<span class="s1">&#39;Hello, Random J. Hacker!&#39;</span> in b<span class="s1">&#39;&lt;!doctype html&gt;\n&lt;title&gt;HelloApp&lt;/title&gt;\n&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/style.css&quot;&gt;\n&lt;nav&gt;\n  &lt;h1&gt;HelloApp&lt;/h...h1&gt;\n\n  &lt;/header&gt;\n  \n\n&lt;p&gt;\n  Howdy, Random J. Hacker!\n&lt;/p&gt;\n&lt;p&gt;\n  &lt;a href=&quot;/&quot;&gt;Again!&lt;/a&gt;\n&lt;/p&gt;\n\n\n\n&lt;/section&gt;&#39;</span>
E        +  where b<span class="s1">&#39;&lt;!doctype html&gt;\n&lt;title&gt;HelloApp&lt;/title&gt;\n&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/style.css&quot;&gt;\n&lt;nav&gt;\n  &lt;h1&gt;HelloApp&lt;/h...h1&gt;\n\n  &lt;/header&gt;\n  \n\n&lt;p&gt;\n  Howdy, Random J. Hacker!\n&lt;/p&gt;\n&lt;p&gt;\n  &lt;a href=&quot;/&quot;&gt;Again!&lt;/a&gt;\n&lt;/p&gt;\n\n\n\n&lt;/section&gt;&#39;</span> <span class="o">=</span> &lt;Response <span class="m">294</span> bytes <span class="o">[</span><span class="m">200</span> OK<span class="o">]</span>&gt;.data

tests/test_greeting.py:33: <span class="nv">AssertionError</span>
<span class="o">===============================</span> <span class="m">1</span> failed, <span class="m">1</span> passed in <span class="m">0</span>.03 <span class="nv">seconds</span> <span class="o">===============================</span>
</pre></div>
</div>
<p>You don’t need to understand everything that’s going on here but, in a
nutshell, the tests verified that the index page of our application
works correctly, but one of the tests fail because the greeting we’re
receiving is “Howdy” instead of “Hello”.</p>
<p>It’s a good thing we have the tests to tell us this but, unfortunately,
nothing is preventing us from deploying this broken app. In fact, go
ahead and deploy the broken code:</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ git add hello/templates/index.html
$ git commit -m <span class="s2">&quot;Broke the Internet!&quot;</span>
$ git push heroku master
</pre></div>
</div>
<p>As you’ll notice, you’re still able to deploy your app. But it’s now
returning the wrong greeting, and millions of users are upset because
they were expecting a polite “Hello” from the app, and now they’re
getting a much more folksy “Howdy”, which seems to rub some of our users
the wrong way.</p>
<p>Is there a way we could prevent this, without manually checking every
time? It would be nice if we could just deploy automatically from our
GitHub repo, and only after CI tests pass.</p>
<p>Before continuing, make sure that you also push to your GitHub
repository:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ git push
</pre></div>
</div>
<p>That way, we can check that you’ve followed the steps described in this
task. You do not need to enter anything into Gradescope for this task.</p>
</div>
<div class="section" id="task-3-create-travis-yml-for-helloapp">
<h2>Task 3: Create .travis.yml for HelloApp<a class="headerlink" href="#task-3-create-travis-yml-for-helloapp" title="Permalink to this headline">¶</a></h2>
<p>[40 points]</p>
<p>As you may remember from our [previous lab]({{&lt; relref “lab6.md” &gt;}}),
we have a way to make sure our app passes all the tests every time we
push.</p>
<p>For this, you should create a <code class="docutils literal notranslate"><span class="pre">.travis.yml</span></code> file in your
<code class="docutils literal notranslate"><span class="pre">2020-lab7-GITHUB_USERNAME</span></code> repo. With Python, there’s no need to
build, so you should just define a single job that runs the command
<code class="docutils literal notranslate"><span class="pre">pytest</span></code> as its test script (in a Linux environment)</p>
<p>In the last task, you made the tests fail. Commit and push your
.travis.yml file and make sure the CI job fails specifically because the
tests are failing (you will need to inspect the job log to see that
<code class="docutils literal notranslate"><span class="pre">pytest</span></code> is failing in your CI build). Take the URL of the failed
build, and enter it in Gradescope.</p>
<p>Now, go back and fix the app so that they all pass. Then, push your
fixed app to both GitHub and to Heroku. Take the URL of the successful
build, and enter it in Gradescope.</p>
</div>
<div class="section" id="task-4-deploy-using-github-integration-with-travis-ci">
<h2>Task 4: Deploy using Github Integration with Travis CI<a class="headerlink" href="#task-4-deploy-using-github-integration-with-travis-ci" title="Permalink to this headline">¶</a></h2>
<p>[20 points]</p>
<p>Wouldn’t it be convenient if we could deploy continuously, as soon as
tests pass? You might think “well, what if we had a deploy phase in our
Travis CI”? This is possible (see
<a class="reference external" href="https://docs.travis-ci.com/user/deployment/heroku/">https://docs.travis-ci.com/user/deployment/heroku/</a>), but it turns out
Heroku makes it <em>even easier</em> than that. On your Heroku app dashboard,
in the “Deploy” tab, under “Deployment method”, select “GitHub - connect
to GitHub” instead of “Heroku Git - Use Heroku CLI”.</p>
<p>Then, you should be able to connect to your repo. To do this, you need
to first select the <code class="docutils literal notranslate"><span class="pre">cmsc22000-labs</span></code> organization under “Search for a
repository to connect to”, and then enter your repository’s name
(<code class="docutils literal notranslate"><span class="pre">2020-lab7-GITHUB_USERNAME</span></code>) in the text field (make sure to click
the “Search” button so Heroku will search for your repository).</p>
<p>Once you connect the repo, you should see an option that says “Automatic
deploys” with a checkbox “Wait for CI to pass before deploy”. Make sure
that checkbox is checked, and then click on “Enable Automatic Deploys”</p>
<p>Make the tests fail again and push to GitHub with a simple <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code>.
The CI tests should fail and, if you navigate to your URL, you’ll see
that the broken version has not been deployed.</p>
<p>{{% warning %}} <strong>Caution:</strong> In the above <code class="docutils literal notranslate"><span class="pre">git</span> <span class="pre">push</span></code> step, <em>don’t</em>
push to Heroku as you did in previous tasks. What’s happening here is
that the Heroku service will now wait for tests to pass CI, and then
automagically pull your code and deploy it. No need to manually push to
Heroku. {{% /warning %}}</p>
<p>Before continuing, fix the tests and make sure your CI tests are passing
again.</p>
<p>Now, we’re going to make a change that doesn’t make the tests fail, to
verify the change is correctly deployed just by pushing to GitHub. If
you look at the app, you’ll see that the main page shows the title “What
is your name?” followed by a form with a field titled “Name”. That
“Name” title seems a bit redundant, so we’re going to remove it. Edit
<code class="docutils literal notranslate"><span class="pre">hello/templates/index.html</span></code> and remove this line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&quot;name&quot;</span><span class="o">&gt;</span><span class="n">Name</span><span class="o">&lt;/</span><span class="n">label</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Now, commit your changes and push to GitHub. Once the CI tests pass,
your updated app should be available on Heroku shortly aftewards. On
your app dashboard on Heroku, you can go to the “Activity” tab to see
whether your latest commit has been deployed (this tab can also provide
details on why an app wasn’t deployed).</p>
<p>For this task, you just need to make sure that you’ve pushed your code
to GitHub as instructed above.</p>
<div class="section" id="submitting-your-lab">
<h3>Submitting your lab<a class="headerlink" href="#submitting-your-lab" title="Permalink to this headline">¶</a></h3>
<p>In this lab, you just need to enter a few URLs into Gradescope (make
sure you’ve done so at the points instructed above). You should also
make sure you’ve pushed your code to GitHub (but will not be submitting
your code through Gradescope; we just need to check that you’ve made the
commits we expected you to make).</p>
</div>
</div>
</div>


    </div>
      
  </div>
</div>
<footer class="footer">
  <div class="container">
    <p class="pull-right">
      <a href="#">Back to top</a>
      
    </p>
    <p>
        &copy; Copyright 2011-2021, The University of Chicago.<br/>
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>